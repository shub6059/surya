(function(b){"use strict";var a={mobileInputElement:'',mobileInputSelector:'',submitBtnSelector:'',mobileOtpInputEl:'',sendOtpBtnEl:'',otpEntered:'',mobileNumberUsed:'',countryCode:'',verifyOtpBtnEl:'',resendOtpBtn:'',otpPinSent:'',api_used:'',countryCodeSelector:'#ihs-country-code .ihs-country-code',mobileVerified:!1,init:function(){this.buildFormSelector(),this.insertAlertBox(),''===a.formElement&&''===a.formSelector,a.addRequiredInputFields(),a.bindEvents()},insertAlertBox:function(){b('body').append('<div id="oc-alert-container"></div>')},showAlert:function(d,a){a=a||'#3089cf',b('.oc-alert-pop-up').remove();var e=document.querySelector('#oc-alert-container'),f='#006E51'===a?'✔':'ⓘ',c='<div class="oc-alert-pop-up"><div class="oc-alert-pop-up-message"><span class="oc-i-icon-pop-up">'+f+'</span>'+d+'</div>'+'<div class="oc-alert-pop-up-close" style="background: '+a+' !important" >'+otp_obj.wpml_messages.ok+'</div>'+'</div>';b(c).css('background',a),b(e).html(c),b('.oc-alert-pop-up-close').on('click',function(a){b('.oc-alert-pop-up').fadeOut()})},buildFormSelector:function(){a.userFormSelector=otp_obj.form_selector,a.submitBtnSelector=otp_obj.submit_btn_selector,a.formElement=b(a.submitBtnSelector).parents('form'),a.formElement.length&&a.formElement.addClass('ihs_si_form'),a.formSelector=!a.userFormSelector?'form.ihs_si_form':a.userFormSelector},bindEvents:function(){a.submitBtnSelector?b(a.submitBtnSelector).on('click',function(b){if(!a.mobileVerified)return b.preventDefault(),a.showAlert(otp_obj.wpml_messages.alerts.pls_verify_otp_first,'#B93A32'),!1}):b(a.formSelector).on('submit',function(b){if(!a.mobileVerified)return b.preventDefault(),a.showAlert(otp_obj.wpml_messages.alerts.pls_enter_req_field,'#B93A32'),!1}),b(a.formSelector).on('click','#ihs-send-otp-btn',a.sendOtpAndCreateVerifyOtpButton),b(a.formSelector).on('click','#ihs-resend-otp-btn-id',function(){a.reCreateSendOtpButton(),a.sendOtpAndCreateVerifyOtpButton()}),b(a.formSelector).on('click','#ihs-submit-otp-btn',function(){var d=b('#ihs-mobile-otp'),c=d.val();c?a.handleOtpVerification(c):a.showAlert(otp_obj.wpml_messages.alerts.pls_enter_otp,'#B93A32')})},sendOtpAndCreateVerifyOtpButton:function(k){var g=b(a.mobileInputSelector),c=g.val(),h=b(a.countryCodeSelector),d=h.val(),e,f=!1,i=[],j=parseInt(otp_obj.ihs_mobile_length,10);e=a.mobileAndCountryCodeValidation(c,f,j,d,i),e||(b('#ihs-mobile-otp').removeClass('ihs-otp-hide'),a.sendOtpAjaxRequest(c,d))},reCreateSendOtpButton:function(){b('#ihs-send-otp-btn').show(),b(a.verifyOtpBtnEl).addClass('ihs-otp-hide'),b('.ihs-otp-required').addClass('ihs-otp-hide'),b('#ihs-resend-otp-btn-id').addClass('ihs-otp-hide'),b(a.mobileInputSelector).attr('readonly',!1),b(a.countryCodeSelector).attr('readonly',!1),b(a.countryCodeSelector).css('color','#555'),b(a.mobileInputSelector).css('opacity','1'),b('#ihs-mobile-otp').val('')},handleOtpVerification:function(b){a.showAlert(otp_obj.wpml_messages.verifying,'#23282d'),'msg91'===a.api_used?a.verifyMsg91Otp(b):'twilio'===a.api_used&&a.verifyTwilioOtp(b)},verifyMsg91Otp:function(d){var c;c=b.post(otp_obj.ajax_url,{action:'ihs_verify_msg91',security:otp_obj.ajax_nonce,data:{mob:a.mobileNumberUsed,country_code:a.countryCode,otp_entered:d}}),c.done(function(d){var c=d.data.response;c.success?(a.mobileVerified=!0,a.showAlert(otp_obj.wpml_messages.alerts.thx_for_verification,'#23282d'),b('.ihs-otp-required.ihs-h').fadeOut(500),b('#ihs-resend-otp-btn-id').fadeOut(500),b('#ihs-verify-otp-popup-container').fadeOut(500),b('.ihs-otp-required').fadeOut(500),a.verifyOtpBtnEl.fadeOut(500)):'otp_expired'===c.error_message?(a.reCreateSendOtpButton(),a.showAlert(c.error_message,'#943734')):'otp_not_verified'===c.error_message?a.showAlert(otp_obj.wpml_messages.alerts.verification_incorrect,'#943734'):a.showAlert(c.error_message,'#943734')})},verifyTwilioOtp:function(c){var d=b.post(otp_obj.ajax_url,{action:'ihs_verify_twilio',security:otp_obj.ajax_nonce,data:{mob:a.mobileNumberUsed,country_code:a.countryCode,otp_entered:c}});d.done(function(d){var c=d.data.response;c.success?(a.mobileVerified=!0,a.showAlert(otp_obj.wpml_messages.alerts.thx_for_verification,'#23282d'),b('.ihs-otp-required').fadeOut(500),b('#ihs-resend-otp-btn-id').fadeOut(500),a.verifyOtpBtnEl.fadeOut(500)):'60023'===c.error_code?(a.reCreateSendOtpButton(),a.showAlert(c.error_message,'#B93A32')):'60022'===c.error_code?a.showAlert(c.error_message,'#B93A32'):'60003'===c.error_code&&a.showAlert(otp_obj.wpml_messages.alerts.tried_too_many_times,'#B93A32')})},mobileAndCountryCodeValidation:function(c,e,d,f,b){if(c||b.push(otp_obj.wpml_messages.alerts.enter_mobile_no),c&&!e&&(d&&d!==c.length&&b.push(otp_obj.wpml_messages.alerts.enter_crt_mobile_no),!d&&c.length<5&&b.push(otp_obj.wpml_messages.alerts.enter_crt_mobile_no)),f||b.push(otp_obj.wpml_messages.alerts.enter_country_code),b.length){var g=b.join('</br>');a.showAlert(g,'#B93A32')}return b.length},addRequiredInputFields:function(){var j='ihs-mobile',g,e,d=otp_obj.input_required,c,h,i,m,l,f,k,n,o;g='ihs-country-code',e=otp_obj.ihs_country_code&&'ALL'!==otp_obj.ihs_country_code?'+'+otp_obj.ihs_country_code:'',h='<div id="ihs-country-code" class="ihs-country-code-exis-mob"><div class="ihs-country-inp-wrap"><span class=""><input type="text" name="'+g+'" value="'+e+'" class="ihs-country-code" required placeholder="e.g. +91" aria-invalid="false" readonly maxlength="5">'+'</span> '+'</div>'+'</div>','Yes'===d?d=!0:'No'===d?d=!1:d=!1,a.mobileInputName=j,d?(f='',o='ihs-mobile',l=e?'readonly':'',k='<label id="ihs-country-code" class="ihs-mobile-no-lab">'+otp_obj.wpml_messages.mobile_box_label+'</label>'+'<div class="ihs-country-inp-wrap">'+'<input type="text" name="'+g+'" value="'+e+'" class="ihs-country-code" required placeholder="e.g. +91" aria-invalid="false" readonly maxlength="5">'+'</div>'+'<div class="ihs-mob-inp-wrap">'+'<input type="text" name="'+o+'" value="" class="ihs-mb-inp-field" aria-required="true" aria-invalid="false">'+'</div>',n=a.formSelector+' input[type="submit"]',c=a.createMobileInputAndOtherFields(j),f='<div class="ihs-mob-country-wrapper" id="ihs-mob-country-wrapper">'+k+'</div>',f+=c.allOtpHtml,a.mobileInputSelector='#ihs-mob-country-wrapper .ihs-mb-inp-field',a.countryCodeSelector='#ihs-mob-country-wrapper .ihs-country-code',b(a.formSelector).append(f),a.setOtpInputElementVar(),a.mobileInputElement=a.setInputElVariables('#ihs-mobile-number')):(i=otp_obj.mobile_input_name,i?(m=a.formSelector+' input[name="'+i+'"]',c=a.createMobileInputAndOtherFields(i),b(c.allOtpHtml).insertAfter(m),a.mobileInputSelector=c.mobileInputNameSelector,a.mobileInputElement=a.setInputElVariables(c.mobileInputNameSelector),a.setOtpInputElementVar(),b(h).insertBefore(a.mobileInputSelector),b(a.mobileInputSelector).addClass('ihs-existing-mob-inp-fld'),b(a.mobileInputSelector).css('width','calc(100% - 5rem)')):(c=a.createMobileInputAndOtherFields(j),b(c.allOtpHtml).insertAfter(c.mobileInputNameSelector),a.mobileInputSelector=c.mobileInputNameSelector,a.mobileInputElement=a.setInputElVariables(c.mobileInputNameSelector),a.setOtpInputElementVar(),b(h).insertBefore(a.mobileInputSelector),b(a.mobileInputSelector).addClass('ihs-existing-mob-inp-fld'),b(a.mobileInputSelector).css('width','calc(100% - 5rem)')))},setOtpInputElementVar:function(){a.mobileOtpInputEl=a.setInputElVariables('#ihs-mobile-otp'),a.mobileOtpHiddenInputEl=a.setInputElVariables('#ihs-otp-hidden'),a.sendOtpBtnEl=a.setInputElVariables('#ihs-send-otp-btn'),a.verifyOtpBtnEl=a.setInputElVariables('#ihs-submit-otp-btn')},setInputElVariables:function(a){return b(a)},createMobileInputAndOtherFields:function(c){var b={},d='<label id="ihs-otp-required" class="ihs-otp-required ihs-otp-hide"> '+otp_obj.wpml_messages.otp_required+'<span class="wrap ihs-otp">'+'<input type="number" id="ihs-mobile-otp" name="ihs-otp" value="" size="40" class="wpcf7-text wpcf7-validates-as-required ihs-otp-hide" aria-required="true" aria-invalid="false">'+'</span>'+'</label>',e='<div class="ihs-otp-btn" id="ihs-send-otp-btn">'+otp_obj.wpml_messages.send_otp+'</div>',f='<div class="ihs-otp-btn ihs-otp-hide" id="ihs-submit-otp-btn">'+otp_obj.wpml_messages.verify_otp+'</div>',g='<div class="ihs-otp-btn ihs-otp-hide" id="ihs-resend-otp-btn-id">'+otp_obj.wpml_messages.resend_otp+'</div>';return b.allOtpHtml=d+e+f+g,b.mobileInputNameSelector=a.formSelector+' input[name="'+c+'"]',b},sendOtpAjaxRequest:function(c,d){b('#ihs-send-otp-btn').hide(),a.showAlert(otp_obj.wpml_messages.sending_otp,'#23282d');var e=b.post(otp_obj.ajax_url,{action:'ihs_otp_ajax_hook',security:otp_obj.ajax_nonce,data:{mob:c,country_code:d}});e.done(function(c){a.api_used=c.data.api,a.mobileNumberUsed=c.data.mobile,a.countryCode=c.data.country_code,'1'===c.data.otp_sent?(a.showAlert(otp_obj.wpml_messages.alerts.otp_sent_to_mobile,'#23282d'),b('#ihs-send-otp-btn').hide(),b(a.verifyOtpBtnEl).removeClass('ihs-otp-hide'),b('.ihs-otp-required').removeClass('ihs-otp-hide'),b('#ihs-resend-otp-btn-id').removeClass('ihs-otp-hide'),b(a.mobileInputSelector).attr('readonly',!0),b(a.countryCodeSelector).attr('readonly',!0),b(a.countryCodeSelector).css('color','#b3b0b0'),b(a.mobileInputSelector).css('opacity','0.5')):(b('#ihs-send-otp-btn').show(),a.showAlert(otp_obj.wpml_messages.alerts.error_try_again,'#23282d'))})}},c;'undefined'!=typeof otp_obj&&(c=otp_obj.form_selector,b(c)&&a.init())})(jQuery)